(function(){if(window.Catalyst===undefined)throw"Catalyst Core not included.";this.Node.implement({locateOffsetNode:function(e){var t=0,n=this.toNode(),r=n;do{n=n.firstChild;if(n)do{var i=n.textContent.length;if(t<=e&&t+i>e)break;t+=i}while(n=n.nextSibling);if(!n)break}while(n&&n.hasChildNodes()&&n.nodeType!=3);if(n)return{node:n,offset:e-t};if(r){n=r;while(n&&n.lastChild)n=n.lastChild;return n.nodeType===3?{node:n,offset:n.textContent.length}:{node:n,offset:0}}return{node:this.toNode(),offset:0}},offsetNode:function(){var e=window.getSelection();if(e.rangeCount){var t=e.getRangeAt(0),n=t.startContainer;n.nodeType===3&&(n=n.parentNode);return n!==this.toNode()?n:!1}return!1},selectionStart:function(){var e=window.getSelection();if(this.isInput()===!0)return this.toNode().selectionStart;if(e.rangeCount){var t=e.getRangeAt(0),n=t.startContainer,r=t.startOffset,i=n;if(!(this.toNode().compareDocumentPosition(n)&16))return 0;do{while(n=n.previousSibling)n.textContent&&(r+=n.textContent.length);n=i=i.parentNode}while(n&&n!==this.toNode());return r}return 0},selectionEnd:function(){var e=window.getSelection();return this.isInput()===!0?this.toNode().selectionEnd:e.rangeCount?this.selectionStart()+(e.getRangeAt(0)+"").length:0},hasSelection:function(){return this.selectionStart()!==this.selectionEnd()?!0:!1},saveCaretPosition:function(){this.setProperty("ss",this.selectionStart(),!0);this.setProperty("se",this.selectionEnd(),!0)},restoreCaretPosition:function(){this.hasProperty("ss",!0)===!0&&this.hasProperty("se",!0)===!0&&this.selectRange(this.getProperty("ss",!0),this.getProperty("se",!0))},selectedText:function(){var e=this.selectionStart(),t=Math.abs(this.selectionEnd()-e),n=this.isInput()===!0?"value":"text";return this.get(n).substr(e,t)},selectRange:function(e,t){var n=this.toNode();this.focus();if(this.isInput()===!0)return this.toNode().setSelectionRange(e,t);var r=document.createRange(),i=window.getSelection(),s=this.locateOffsetNode(e);r.setStart(s.node,s.offset);t&&t!=e&&(s=this.locateOffsetNode(t));r.setEnd(s.node,s.offset);i.removeAllRanges();i.addRange(r);this.saveCaretPosition()},textObject:function(){var e=this.selectionStart(),t=this.selectionEnd(),n=15,r=this.isInput()===!0?this.get("value"):this.get("text"),i=r.split("\n"),s=r.substr(0,e),o=r.substr(t,r.length),u=this.selectedText(),a=this.getSize(),f=this.getSize(!0),l=this.scroll(),c=Math.floor(Math.abs(f.height/n)),h=Math.floor(Math.abs(a.height/n)),p=Math.floor(Math.abs(l.top/n)),d=c-(p+h+1),v=r.substr(0,e).split("\n").length,m=i[v-1];return{selectionStart:e,selectionEnd:t,textBefore:s,textAfter:o,textSelected:u,linesBefore:i.slice(0,p).join("\n"),linesAfter:i.slice(p+h+1,i.length).join("\n"),linesVisible:i.slice(p,p+h+1).join("\n"),linesBeforeCurrent:i.slice(0,v-1).join("\n"),linesAfterCurrent:i.slice(v).join("\n"),currentLine:m,currentLineNumber:v,numVisibleLines:h,numLinesBefore:p,numLinesAfter:d,numLines:c}},selectText:function(e,t){t=typeOf(t)==="string"?t:"before";var n=this.textObject(),r=this.isInput()===!0?this.get("value"):this.get("text"),i=0,s=0;if(r==="")return;switch(t){case"before":if(n.textBefore.contains(e)===!0){i=n.textBefore.lastIndexOf(e);i=i!==-1?i:0}break;case"after":if(n.textAfter.contains(e)===!0){i=n.textAfter.indexOf(e);i+=n.textBefore.length+n.textSelected.length}}if((i===0&&s===0)==0){s=i+e.length;this.selectRange(i,s)}},insertText:function(e,t,n,r,i){r=r===!1?!1:!0;i=typeOf(i)==="string"?i:"insertText";var s=this.isInput()===!0?"value":"text",o=this.get(s),u=this.selectionStart(),a=this.selectionEnd(),f=this.textObject(),l=f.textBefore,c=f.textAfter,h=f.textSelected;r===!1&&(l+=h);l+=t||"";c=(n||"")+c;e.length===0&&(e=h);u=l.length;a=l.length+e.length;switch(i){case"moveBefore":u-=t.length;a=u;break;case"moveAfter":u=a;break;case"contextString":u-=t.length;a=u+t.length+e.length+n.length;break;case"noSelection":a=u}this.set(s,l+e+c);this.selectRange(u,a)},wrapText:function(e,t){this.insertText("",e,t,!0,"moveAfter")}})}).call(window);